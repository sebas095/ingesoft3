{% extends "base.html" %}
{% load staticfiles %}
{% block link %}
<link href="{% static 'assets/css/datepicker.css' %}" rel="stylesheet" />
{% endblock %}
{% block content %}
  <div class="row">
                    <div class="col-md-12">
                     <h2><i class="fa fa-folder-open fa-1x"></i> Crear Presupuesto</h2>   
                     </br>
                        <h5> {{ user.username }}, por favor diligencie el siguiente formulario con la información del Presupuesto. Tenga en cuenta que los campos marcados con * son obligatorios. </h5>
                       
                    </div>
                </div>
                 <!-- /. ROW  -->
                 <hr />
               <div class="row">

                <div class="col-md-12">
                    <!-- Form Elements -->
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            Presupuesto
                        </div>
                        <div class="panel-body">
                        <div class="row">
						
						
						
						
						
						
						<div id="accordion">
						  <h3>Section 1</h3>
						  <div>
							<p>
							Mauris mauris ante, blandit et, ultrices a, suscipit eget, quam. Integer
							ut neque. Vivamus nisi metus, molestie vel, gravida in, condimentum sit
							amet, nunc. Nam a nibh. Donec suscipit eros. Nam mi. Proin viverra leo ut
							odio. Curabitur malesuada. Vestibulum a velit eu ante scelerisque vulputate.
							</p>
						  </div>
						  <h3>Section 2</h3>
						  <div>
							<p>
							Sed non urna. Donec et ante. Phasellus eu ligula. Vestibulum sit amet
							purus. Vivamus hendrerit, dolor at aliquet laoreet, mauris turpis porttitor
							velit, faucibus interdum tellus libero ac justo. Vivamus non quam. In
							suscipit faucibus urna.
							</p>
						  </div>
						  <h3>Section 3</h3>
						  <div>
							<p>
							Nam enim risus, molestie et, porta ac, aliquam ac, risus. Quisque lobortis.
							Phasellus pellentesque purus in massa. Aenean in pede. Phasellus ac libero
							ac tellus pellentesque semper. Sed ac felis. Sed commodo, magna quis
							lacinia ornare, quam ante aliquam nisi, eu iaculis leo purus venenatis dui.
							</p>
							<ul>
							  <li>List item one</li>
							  <li>List item two</li>
							  <li>List item three</li>
							</ul>
						  </div>
						  <h3>Section 4</h3>
						  <div>
							<p>
							Cras dictum. Pellentesque habitant morbi tristique senectus et netus
							et malesuada fames ac turpis egestas. Vestibulum ante ipsum primis in
							faucibus orci luctus et ultrices posuere cubilia Curae; Aenean lacinia
							mauris vel est.
							</p>
							<p>
							Suspendisse eu nisl. Nullam ut libero. Integer dignissim consequat lectus.
							Class aptent taciti sociosqu ad litora torquent per conubia nostra, per
							inceptos himenaeos.
							</p>
						  </div>
						</div>
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
                               
                                <div class="col-md-6">
                                     
                                    </br>
                                    <form method="POST" action="/" id="DatosPresupuesto" role="form"  enctype="multipart/form-data">{% csrf_token %}


                                    <div class="form-group">
                                            <label>Logo del proyecto</label>
                                            <input type="file" id="foto_proyecto" name="foto_proyecto" />
                                    </div>
                                    
                                        <div class="form-group">
                                            <label>*Id. del presupuesto: </label>
                                            <input id="id_presupuesto" name="id_presupuesto" class="form-control requerido" placeholder="Identificador único del presupuesto" required/>
                                        </div>
                                        <div class="form-group">
                                            <label>*Nombre del presupuesto: </label>
                                            <input id="nombre_presupuesto" name="nombre_presupuesto" class="form-control requerido" placeholder="Ingresa el nombre del presupuesto" required/>
                                        </div>
                                        <div class="form-group">
                                            <label>Nombre del proyecto: </label>
                                            <input name="nombre_proyecto" class="form-control" placeholder="Ingresa el nombre del proyecto" />
                                        </div>
                                        </br>
                                        <h6 style="color:red">Los campos marcados con * son obligatorios</h6>



                                 
                                </div>
                                
                                <div class="col-md-6">
                                        </br>
                                        <div class="form-group">
                                            <label>Logo de la constructora</label>
                                            <input type="file" id="id_foto_constructora" name="foto_constructora" />
                                        </div>
                                        <div class="form-group">
                                            <label>Nombre de la constructora: </label>
                                            <input name="nombre_constructora" class="form-control" placeholder="Ingresa el nombre de la constructora" />
                                        </div>
                                        <div class="form-group">
                                            <label>Fecha de Entrega: </label>
                                            <input name="fecha_entrega" name="fecha_entrega" class="datepicker form-control" type="text" data-provide="datepicker"placeholder="Selecciona la fecha de entrega del presupuesto">
                                        </div>
                                    </form>

                                    </br>
                                    <button id="GuardarDatos" type="button" class="btn btn-success btn-lg btn-block">Guardar datos</button>
                                                    
                                        
                                </div>
                            </div>
                        </div>
                    </div>
                     <!-- End Form Elements -->
                </div>
            </div>
            

                <!-- Modal MENSAJE ERROR -->
                <div id="mensaje_error" class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Espera!</h4>
                      </div>
                      <div class="modal-body">
                        Debes llenar como mínimo los campos que contienen *
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal">Cerrar</button>
                      </div>
                    </div>
                  </div>
                </div>


                <div id="mensaje_existe" class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Espera!</h4>
                      </div>
                      <div class="modal-body">
                        <div id="error"> </div>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal">Cerrar</button>
                      </div>
                    </div>
                  </div>
                </div>






                <div class="modal fade" id="mensaje_exito" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            Éxito
                        </div>
                        <div class="modal-body">
                            La información ha sido guardada satisfactoriamente
                        </div>
                        <div class="modal-footer">
                            <button id="aceptar" type="button" class="btn btn-primary" data-dismiss="modal">Aceptar</button>
                        </div>
                    </div>
                </div>
            </div>




            <div id="confirm" class="modal hide fade">
              <div class="modal-body">
                Delete?
              </div>
              <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn btn-primary" id="delete">Delete</button>
                <button type="button" data-dismiss="modal" class="btn">Cancel</button>
              </div>
            </div>

{% csrf_token %}

{% endblock %}
{% block scripts %}
<script src="{% static 'assets/js/bootstrap-datepicker.js' %}"></script>
<script type="text/javascript">

//--------------------------------  CSRF TOKEN----------------------------
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }



    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
                // Only send the token to relative URLs i.e. locally.
                xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
            }
        }
    });

//---------------------------------------------------------------------------------


    $( document ).ready(function() {

            $('.datepicker').datepicker({
                format: 'yyyy-mm-dd',
                language: 'es'
            });
			
			$( "#accordion" ).accordion();

            

            $("#GuardarDatos").click(function(e){
                e.preventDefault();

    
                var valid = true;
                $('.requerido').each(function(){
                   if( $(this).val() == '' ){
                      valid = false;
                      $(this).parent().addClass('has-error');
                   }else{
                       $(this).parent().removeClass('has-error');
                   }
                });
                
                if(valid){
                    
                    data= $("#DatosPresupuesto").serialize();
                    var formData= new FormData($("#DatosPresupuesto")[0],data);
                    console.log(formData);
                    $.ajax({
                        url: "",
                        type: 'POST',
                        async: true,
                        //contentType:"application/json",
                        contentType: false,
                        processData: false,

                        dateType:"json",
                        data: formData,
                        success: function(resp){
                            $("#respuesta").html(resp.message);
                            if(resp.message == '1'){
                                $('#mensaje_exito').modal('show').one('click', '#aceptar', function (e) {
                                        window.location.replace("")
                                });;

                            }else{
                                for(var index in resp.message){
                                    $('#error').html(resp.message[index]);
                                }
                                $('#mensaje_existe').modal('show');
                            }
                        },
                        error: function(jqXHR,estado,error){
                            alert("Error: "+error+"     Estado: "+estado);
                        },
                         
                    });
                }else{
                    $('#mensaje_error').modal('show');
                }


            });

    });
</script>
{% endblock %}